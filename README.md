# Сервис user-log
--------------------
 Задача заключалась в настройке и выполнении миграций базы данных и наполнении тестовыми данными не существующих пользователей 
 в количестве которе понадобиться по работе в приложении. Развернуть и настроить Docker-окружение для Node.js-приложения, 
 которое будет использовать такие комопоненты как:

 1. PostgreSQL - основная база данных

 2. Redis - кеширование результатов сидинга

 3. Knex.js - инструмент для миграций и сидов

 4. TypeScript - язык разработки

 5. Docker - контейнеризация окружения



## Ключевые задачи:
### 1.0 Миграции БД
    1.1  Автоматическое создание/обновление структуры таблиц через knex migrate:latest
    1.2  Контроль состояния (Already up to date = миграции применены)

### 2.0 Загрузка тестовых данных (seeds)
    2.1 Наполнение БД фиктивными данными (например, пользователями) через knex seed:run
    2.2 Кеширование в Redis для избежания повторного сидинга (Users already seeded (cached))

### 3.0 Интеграция в Docker
    3.1 Оркестрация сервисов (postgres, redis, app, migrate) через docker-compose.yml
    3.2 Health-чеки для проверки работоспособности БД

### 4.0 Решение проблем модульности
    4.1 Настройка ts-node/esm для работы с ES-модулями в TypeScript
    4.2 Конфигурация путей через tsconfig.json (aliases, baseUrl)
    
### 5.0 Решение проблем модульности
    5.1 Настройка ts-node/esm для работы с ES-модулями в TypeScript
    5.2 Конфигурация путей через tsconfig.json (aliases, baseUrl)

Результат проведеной работы такой. Миграции выполненны БД создана и наполненна не существующими пользователями практически со всеми данными пользователя - такими как Ф.И.О. 
номер телефона, email и т.д. Стабильное окружение (Docker + корректные импорты).

### Комнады 
-------------
<pre> ```docker-compose down -v``` </pre>
останавливаем и удаляем контейнеры, созданные с помощью docker-compose up

<pre> ```docker system prune -a ``` </pre>
очищаем Docker от всех неиспользуемых объектов: остановленных контейнеров, неиспользуемых сетей, висячих образов (dangling images) и неиспользуемых томов. Опция -a (или --all) расширяет очистку, удаляя все неиспользуемые образы, а не только висячие.

<pre>```docker-compose up -d --build```</pre>
Перед запуском пересобираем образы, даже если они уже существуют и запускаем контейнеры, описанные в docker-compose.yml в фоновом режиме не блокируя терминал

<pre>```docker-compose run --rm migrate npm run migrate:up```</pre>
Выполненим новые миграции (обновляет структуру базы данных).

<pre>```docker-compose run --rm migrate npm run seed:run```</pre>
 Заполнении базы данных начальными (seed) данными.

<pre>``` docker-compose exec postgres psql -U postgres -d user-log -c "SELECT id, username, email FROM users;"```</pre>
Выполним команду внутри уже запущенного контейнера сервиса postgres и выполним SQL-запрос, который выбирает поля id, username и email из таблицы users.

Система готова к работе с актуальной схемой БД и тестовыми данными, развернутыми в изолированном Docker-окружении. 
Да! Тесты не писал для этого сервиса. Может напишу, пока не решил!

## Тесты
--------
Команды для локального запуска тестов:

для запуска модульных тестов проверки мелких сценариев на работаспасобность 
<pre>```npm test ```</pre>

Запускает интеграционные тесты для проверки соединения с бд, API, внешними сервисами 
а так же для проверки работоспособности при взаимодействии друг с дргугом
<pre>```npm run test:integration```</pre>

npm run test:e2e — end-to-end тесты

Запуск через Docker:

npm run test:docker — все тесты (с пересозданием контейнеров)

npm run test:docker:unit — только unit-тесты

npm run test:docker:integration — интеграционные тесты

npm run test:docker:e2e — e2e-тесты


